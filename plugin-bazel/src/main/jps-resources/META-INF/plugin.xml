<idea-plugin>
  <id>org.jetbrains.bazel</id>
  <category>Build Tools</category>
  <vendor>JetBrains</vendor>
  <name>Bazel</name>
  <description
  ><![CDATA[
  <p>Bazel by JetBrains for IntelliJ IDEA</p>

  <p>Main features</p>
  <ul>
      <li>Open Bazel projects in IntelliJ IDEA</li>
      <li>Supports Java and Kotlin</li>
      <li>Build, run, test, debug Bazel targets</li>
      <li>Starlark syntax, completion, navigation support</li>
      <li>Starlark debugging</li>
      <li>Run and debug tests running in Bazel</li>
  </ul>

  <p>To learn more about how to use the features, please check <a href="https://www.jetbrains.com/help/idea/bazel.html">the documentation page</a>.</p>
  ]]>
  </description>

  <resource-bundle>messages.BazelPluginBundle</resource-bundle>
  <dependencies>
    <plugin id="com.intellij.modules.lang" />
    <module name="intellij.platform.searchEverywhere" />
    <module name="intellij.libraries.grpc"/>
  </dependencies>

  <content namespace="jetbrains">
    <module name="intellij.bazel.kotlin.k2"/>
  </content>

  <depends
    config-file="withCodeWithMe.xml"
    optional="true"
  >com.jetbrains.codeWithMe</depends>
  <depends
    config-file="withCoverage.xml"
    optional="true"
  >com.intellij.modules.coverage</depends>
  <depends
    config-file="withDevKit.xml"
    optional="true"
  >DevKit</depends>
  <depends
    config-file="withGo.xml"
    optional="true"
  >org.jetbrains.plugins.go</depends>
  <depends
    config-file="withIdeStarter.xml"
    optional="true"
  >com.jetbrains.performancePlugin</depends>
  <depends
    config-file="withJava.xml"
    optional="true"
  >com.intellij.modules.java</depends>
  <depends
    config-file="withJunit.xml"
    optional="true"
  >JUnit</depends>
  <depends
    config-file="withKotlin.xml"
    optional="true"
  >org.jetbrains.kotlin</depends>
  <depends
    config-file="withPython.xml"
    optional="true"
  >com.intellij.modules.python</depends>
  <depends
    config-file="withTerminal.xml"
    optional="true"
  >org.jetbrains.plugins.terminal</depends>
  <depends
    config-file="withProtobuf.xml"
    optional="true"
  >idea.plugin.protoeditor</depends>

  <extensionPoints>
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.utils.SourceTypeIconProvider"
      qualifiedName="org.jetbrains.bazel.sourceTypeIconProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.scala.sdk.ScalaSdkExtension"
      qualifiedName="org.jetbrains.bazel.scalaSdkExtension"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.run.RunHandlerProvider"
      qualifiedName="org.jetbrains.bazel.runHandlerProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.projectAware.ProjectAwareExtension"
      qualifiedName="org.jetbrains.bazel.projectAwareExtension"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.run.config.RunConfigurationExtensionManager"
      qualifiedName="org.jetbrains.bazel.runConfigurationExtension"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.sync.ProjectSyncHook"
      qualifiedName="org.jetbrains.bazel.projectSyncHook"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.sync.ProjectPreSyncHook"
      qualifiedName="org.jetbrains.bazel.projectPreSyncHook"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.sync.ProjectPostSyncHook"
      qualifiedName="org.jetbrains.bazel.projectPostSyncHook"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.sync.projectStructure.ProjectStructureProvider"
      qualifiedName="org.jetbrains.bazel.projectStructureProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.buildTask.AdditionalProjectTaskRunnerProvider"
      qualifiedName="org.jetbrains.bazel.additionalProjectTaskRunnerProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.ui.projectTree.TreeStructureSettingsProvider"
      qualifiedName="org.jetbrains.bazel.treeStructureSettingsExtension"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.extensionPoints.JvmBinaryJarsExtension"
      qualifiedName="org.jetbrains.bazel.jvmBinaryJarsExtension"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.runnerAction.LocalJvmRunnerRunConfigurationProvider"
      qualifiedName="org.jetbrains.bazel.localJvmRunnerRunConfigurationProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.magicmetamodel.impl.workspacemodel.impl.updaters.KotlinFacetEntityUpdater"
      qualifiedName="org.jetbrains.bazel.kotlinFacetEntityUpdater"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.run.coverage.BazelCoverageClassNodeDecoratorPsiElementClassifier"
      qualifiedName="org.jetbrains.bazel.bazelCoverageClassNodeDecoratorPsiElementClassifier"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.ui.notifications.UnresolvedImportChecker"
      qualifiedName="org.jetbrains.bazel.unresolvedImportChecker"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.junit.PsiElementConfigurationLocator"
      qualifiedName="org.jetbrains.bazel.psiElementConfigurationLocator"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.sync.TargetKindProvider"
      qualifiedName="org.jetbrains.bazel.targetKindProvider"
    />
    <extensionPoint
      dynamic="true"
      interface="org.jetbrains.bazel.ui.settings.BazelSettingsProvider"
      qualifiedName="org.jetbrains.bazel.bazelExperimentalSettingsProvider"
    />
    <extensionPoint
      interface="org.jetbrains.bazel.ui.settings.BazelSettingsProvider"
      qualifiedName="org.jetbrains.bazel.bazelGeneralSettingsProvider"
    />
    <extensionPoint
      interface="org.jetbrains.bazel.sync.projectStructure.legacy.WorkspaceModuleProjectSyncHook$EnableWorkspaceModuleSyncHookExtension"
      qualifiedName="org.jetbrains.bazel.workspaceModuleSyncHook.enable"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.bazelVersionResolver"
                    interface="org.jetbrains.bazel.languages.bazelversion.service.BazelVersionResolver"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.starlarkGlobalFunctionProvider"
                    interface="org.jetbrains.bazel.languages.starlark.bazel.StarlarkGlobalFunctionProvider"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.starlarkClassParametersProvider"
                    interface="org.jetbrains.bazel.languages.starlark.bazel.StarlarkClassParametersProvider"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.projectViewSectionProvider"
                    interface="org.jetbrains.bazel.languages.projectview.ProjectViewSectionProvider"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.testLocatorProvider"
                    interface="org.jetbrains.bazel.run.test.BazelTestLocatorProvider"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.javaSourceRootPrefixContributor"
                    interface="org.jetbrains.bazel.sync.workspace.languages.java.sourceRoot.prefix.JavaSourceRootPatternContributor"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.indexAdditionalFilesContributor"
                    interface="org.jetbrains.bazel.workspace.indexAdditionalFiles.IndexAdditionalFilesContributor"
                    dynamic="true"
    />
    <extensionPoint qualifiedName="org.jetbrains.bazel.syntheticRunTargetTemplateGenerator"
                    dynamic="true"
                    beanClass="com.intellij.lang.LanguageExtensionPoint">
      <with attribute="implementationClass" implements="org.jetbrains.bazel.run.synthetic.SyntheticRunTargetTemplateGenerator"/>
    </extensionPoint>
    <extensionPoint qualifiedName="org.jetbrains.bazel.buildTargetLanguageInferenceContributor"
                    interface="org.jetbrains.bazel.target.lang.BuildTargetLangInferenceContributor"
                    dynamic="true"/>
  </extensionPoints>

  <projectListeners>
    <listener topic="com.intellij.execution.ExecutionListener"
              class="org.jetbrains.bazel.run.synthetic.SyntheticRunExecutionListener"/>
  </projectListeners>

  <!-- it needs to be here, not in withKotlin.xml because plugin loader checks only this file -->
  <extensions defaultExtensionNs="org.jetbrains.kotlin">
    <supportsKotlinPluginMode
      supportsK1="true"
      supportsK2="true"
    />
  </extensions>

  <extensions defaultExtensionNs="org.jetbrains.bazel">
    <javaSourceRootPrefixContributor implementation="org.jetbrains.bazel.sync.workspace.languages.java.sourceRoot.prefix.JavaProjectViewSourceRootPatternContributor"/>
    <projectViewSectionProvider
      implementation="org.jetbrains.bazel.sync.workspace.languages.java.sourceRoot.projectview.JavaSROProjectViewSectionProvider"/>

    <projectPreSyncHook implementation="org.jetbrains.bazel.flow.open.RegenerateProjectViewFileContentPreSyncHook" />

    <projectSyncHook
      id="DirectoriesSyncHook"
      implementation="org.jetbrains.bazel.flow.sync.DirectoriesSyncHook"
      order="after TargetUtilsSyncHook"
    />
    <projectSyncHook
      id="BazelRepoMappingSyncHook"
      implementation="org.jetbrains.bazel.languages.starlark.repomapping.BazelRepoMappingSyncHook"
    />
    <projectSyncHook implementation="org.jetbrains.bazel.run.import.ImportRunConfigurationsSyncHook" />
    <projectSyncHook implementation="org.jetbrains.bazel.fastbuild.ToolchainInfoSyncHook" />
    <projectSyncHook implementation="org.jetbrains.bazel.flow.sync.PathSyncHook" />
    <projectSyncHook
      id="TargetUtilsSyncHook"
      implementation="org.jetbrains.bazel.target.sync.TargetUtilsSyncHook"
    />
    <projectSyncHook
      implementation="org.jetbrains.bazel.sync.projectStructure.legacy.WorkspaceModuleProjectSyncHook"
      order="after TargetUtilsSyncHook"
    />
    <projectSyncHook
      id="IndexAdditionalFilesSyncHook"
      implementation="org.jetbrains.bazel.workspace.indexAdditionalFiles.IndexAdditionalFilesSyncHook"
      order="after DirectoriesSyncHook"
    />

    <projectPostSyncHook implementation="org.jetbrains.bazel.ui.widgets.fileTargets.BazelFileTargetsWidgetSyncHook" />
    <projectPostSyncHook implementation="org.jetbrains.bazel.flow.sync.RemoveExcludedVcsMappingsSyncHook" />
    <projectPostSyncHook implementation="org.jetbrains.bazel.sync.SyncCache$ClearSyncCache" />
    <projectPostSyncHook implementation="org.jetbrains.bazel.languages.bazelversion.sync.BazelVersionFetchSyncHook"/>
    <projectPostSyncHook implementation="org.jetbrains.bazel.ui.notifications.BuildAndResyncOnUnresolvedImportNotificationsProvider$NotificationUpdateSyncHook"/>


    <projectStructureProvider
      implementation="org.jetbrains.bazel.sync.projectStructure.workspaceModel.WorkspaceModelProjectStructureProvider"
      order="after TargetUtilsProjectStructureProvider"
    />
    <projectStructureProvider
      id="TargetUtilsProjectStructureProvider"
      implementation="org.jetbrains.bazel.target.sync.projectStructure.TargetUtilsProjectStructureProvider"
    />

    <runHandlerProvider
      id="JvmRunHandlerProvider"
      implementation="org.jetbrains.bazel.jvm.run.JvmRunHandler$JvmRunHandlerProvider"
    />
    <runHandlerProvider
      id="JvmTestHandlerProvider"
      implementation="org.jetbrains.bazel.jvm.run.JvmTestHandler$JvmTestHandlerProvider"
    />
    <runHandlerProvider
      implementation="org.jetbrains.bazel.run.handler.GenericRunHandlerProvider"
      order="last"
    />
    <runHandlerProvider
      implementation="org.jetbrains.bazel.run.handler.GenericTestHandlerProvider"
      order="last"
    />
    <projectAwareExtension implementation="org.jetbrains.bazel.flow.open.BazelProjectAwareExtension" />

    <additionalProjectTaskRunnerProvider implementation="org.jetbrains.bazel.hotswap.BazelHotSwapProjectTaskRunnerProvider"/>
    <targetKindProvider implementation="org.jetbrains.bazel.sync.GenericBazelRules"/>

    <bazelVersionResolver implementation="org.jetbrains.bazel.languages.bazelversion.service.resolver.BazelGithubVersionResolver"/>

    <starlarkGlobalFunctionProvider implementation="org.jetbrains.bazel.languages.starlark.bazel.DefaultBazelGlobalFunctionProvider"/>

    <starlarkClassParametersProvider implementation="org.jetbrains.bazel.languages.starlark.bazel.DefaultStarlarkClassParametersProvider"/>

    <projectViewSectionProvider implementation="org.jetbrains.bazel.languages.projectview.DefaultProjectViewSectionProvider"/>
  </extensions>

  <extensions defaultExtensionNs="ByteCodeViewer">
    <classFileFinder implementation="org.jetbrains.bazel.bytecodeViewer.BazelBytecodeViewerClassFileFinder"/>
  </extensions>

  <extensions defaultExtensionNs="com.intellij">
    <registryKey
      defaultValue="false"
      description="Build project on initial project sync"
      key="bazel.build.project.on.sync"
    />
    <registryKey
      defaultValue="true"
      description="Python modules support"
      key="bsp.python.support"
    />
    <registryKey
      defaultValue="true"
      description="Go modules support"
      key="bsp.go.support"
    />
    <registryKey
      defaultValue="true"
      description="Shorten module/library names by hashing the first parts and retaining the others"
      key="bsp.shorten.module.library.names"
    />
    <registryKey
      defaultValue="true"
      description="Execute second phase of the phased sync. `bsp.use.phased.sync` has to be enabled to use this flag. It should be used only for testing purposes."
      key="bsp.execute.second.phase.on.sync"
    />
    <registryKey
      defaultValue=""
      description="Add dependencies to so-called &quot;dummy&quot; modules to make Java resolve work correctly. Set to either true, false, or leave empty for the default value."
      key="bsp.add.dummy.module.dependencies"
    />
    <registryKey
      defaultValue="true"
      description="Exclude class files inside jars (and source files inside source jars) if they match up with a source file in the current project."
      key="bsp.exclude.compiled.source.code.inside.jars"
    />
    <!-- https://youtrack.jetbrains.com/issue/BAZEL-1734 -->
    <registryKey
      defaultValue="false"
      description="Enable partial sync action for a target."
      key="bsp.enable.partial.sync"
    />
    <registryKey
      defaultValue="false"
      description="Enables a fast compile mechanism for Java by delegating directly to the Bazel builder"
      key="bazel.enable.jvm.fastbuild"
    />
    <registryKey
      defaultValue="25"
      description="Maximum number of attempts to connect with the Starlark debugger socket"
      key="bazel.starlark.debug.socket.attempts"
    />
    <registryKey
      defaultValue="400"
      description="Interval (in milliseconds) between attempts to connect with the Starlark debugger socket"
      key="bazel.starlark.debug.socket.interval"
    />
    <registryKey
      defaultValue="2"
      description="How many levels to go down when scanning the project for Bazel symlinks to exclude"
      key="bazel.symlink.scan.max.depth"
    />
    <registryKey
      defaultValue="true"
      description="Force Bazel to shut down before each shard build to prevent Bazel memory leak issue"
      key="bazel.shutdown.before.shard.build"
    />
    <registryKey
      defaultValue="false"
      description="Enable a custom class finder for Java instead of &quot;dummy&quot; modules"
      key="bazel.enable.custom.java.class.finder"
    />
    <registryKey
      defaultValue="false"
      description="Create fake module on project import"
      key="bazel.create.fake.module.on.project.import"
      />
    <registryKey
      defaultValue="true"
      description="Add the whole directory to IntelliJ project model instead of individual files when it's possible"
      key="bazel.merge.source.roots"
    />
    <registryKey
      defaultValue="true"
      description="Check and warn about shared sources in the project by showing the &quot;Shared sources detected&quot; notification"
      key="bazel.check.shared.sources"
    />
    <registryKey
      defaultValue="false"
      description="Whether the Bazel plugin should import automatically even if .idea or another project model (e.g., Gradle) exists already"
      key="bazel.project.auto.open.if.present"
    />
    <registryKey
      defaultValue="true"
      description="Whether the Bazel Query tab should be enabled in tool window (where target tree is)"
      key="bazel.query.tab.enabled"
    />

    <!--Restart required here to clear cache-->
    <registryKey
      defaultValue="false"
      description="Bazel Query autocompletion in new 2024 terminal"
      key="bazel.query.terminal.completion"
      restartRequired="true"
    />

    <registryKey
      defaultValue="true"
      description="Exclude Bazel symlinks from IDEA's file watcher via reflection to work around platform bugs"
      key="bazel.exclude.symlinks.from.file.watcher.via.reflection"
      restartRequired="true"
    />

    <registryKey
      defaultValue="true"
      description="&quot;Find in files&quot; also searches directories that are neither included nor excluded in the project view"
      key="bazel.find.in.files.non.indexable"
      restartRequired="true"
    />

    <registryKey
      defaultValue="true"
      description="If enabled, sets the default value of &quot;Run with Bazel&quot; to 'true' for new run configurations. This can be overriden with a project view flag."
      key="bazel.run.config.run.with.bazel"
      restartRequired="false"
    />

    <registryKey defaultValue="false"
                 description="Enable running non-binary bazel targets using synthetically generated targets"
                 key="bazel.run.synthetic.enable"
                 restartRequired="true"
    />
    <registryKey defaultValue="false"
                 description="Disable bazel visibility checks when running syhthetic binary targets"
                 key="bazel.run.synthetic.disable.visibility.check"
                 restartRequired="false"
    />

    <activityTracker implementation="org.jetbrains.bazel.startup.BazelStartupActivityTracker" />
    <runConfigurationProducerSuppressor implementation="org.jetbrains.bazel.run.BazelRunConfigurationProducerSuppressor" />
    <runConfigurationProducer implementation="org.jetbrains.bazel.run.test.BazelRerunTestConfigurationProducer" />
    <stepsBeforeRunProvider implementation="org.jetbrains.bazel.run.synthetic.GenerateSyntheticTargetRunTaskProvider"/>

    <projectService
      serviceImplementation="org.jetbrains.bazel.sync.workspace.DefaultBazelWorkspaceResolveService"
      serviceInterface="org.jetbrains.bazel.sync.workspace.BazelWorkspaceResolveService"
    />

    <projectService
      overrides="true"
      serviceImplementation="org.jetbrains.bazel.services.BazelBaseProjectDirectories"
      serviceInterface="com.intellij.openapi.project.BaseProjectDirectories"
    />
    <moduleService
      overrides="true"
      serviceImplementation="org.jetbrains.bazel.services.BazelModuleFileIndex"
      serviceInterface="com.intellij.openapi.roots.ModuleFileIndex"
    />

    <commandLineInspectionProjectConfigurator
      implementation="org.jetbrains.bazel.startup.BazelCommandLineInspectionConfigurator"
    />
    <configurationType implementation="org.jetbrains.bazel.run.config.BazelRunConfigurationType" />

    <notificationGroup
      displayType="STICKY_BALLOON"
      id="Bazel"
      key="notificationGroup.Bazel.title"
    />

    <workspaceModel.fileIndexContributor
      implementation="org.jetbrains.bazel.workspace.BazelProjectDirectoriesWorkspaceFileIndexContributor"
    />
    <workspaceModel.fileIndexContributor
      implementation="org.jetbrains.bazel.workspace.DummyModuleExclusionWorkspaceFileIndexContributor"
    />
    <ignoredFileProvider implementation="org.jetbrains.bazel.workspace.BazelProjectExcludesIgnoredFileProvider" />
    <moduleType
      id="BAZEL_DUMMY_MODULE_TYPE"
      implementationClass="org.jetbrains.bazel.magicmetamodel.impl.workspacemodel.impl.updaters.transformers.BazelDummyModuleType"
    />
    <workspaceModel.fileIndexContributor
      implementation="org.jetbrains.bazel.workspace.CompiledSourceCodeInsideJarExcludeWorkspaceFileIndexContributor"
    />
    <workspaceModel.fileIndexContributor
      implementation="org.jetbrains.bazel.workspace.packageMarker.PackageMarkerEntityWorkspaceFileIndexContributor"
    />

    <postStartupActivity implementation="org.jetbrains.bazel.startup.BazelStartupActivity" />

    <treeStructureProvider implementation="org.jetbrains.bazel.ui.projectTree.BazelTreeStructureProvider" />
    <projectViewNodeDecorator implementation="org.jetbrains.bazel.ui.projectTree.BazelProjectViewNodeDecorator" />
    <projectTaskRunner
      id="BazelProjectTaskRunner"
      implementation="org.jetbrains.bazel.buildTask.BazelProjectTaskRunner"
    />
    <projectTaskRunner
      implementation="org.jetbrains.bazel.fastbuild.BazelFastBuildProjectTaskRunner"
      order="before BazelProjectTaskRunner"
    />
    <programRunner implementation="org.jetbrains.bazel.jvm.run.BazelJvmDebugRunner" />

    <directoryProjectConfigurator
      implementation="org.jetbrains.bazel.flow.open.CounterPlatformProjectConfigurator"
      order="last"
    />
    <!--    <projectService serviceInterface="com.intellij.openapi.roots.SingleFileSourcesTracker"-->
    <!--                    serviceImplementation="org.jetbrains.bazel.services.SingleFileSourcesTrackerImpl"-->
    <!--                    overrides="true"/>-->
    <statusBarWidgetFactory
      id="BazelFileTargetsWidget"
      implementation="org.jetbrains.bazel.ui.widgets.fileTargets.BazelFileTargetsWidgetFactory"
    />

    <toolWindowAllowlist id="Bazel" />
    <toolWindowExtractor
      implementation="org.jetbrains.bazel.ui.widgets.tool.window.all.targets.BazelToolWindowViewModelExtractor"
    />

    <toolWindow
      anchor="right"
      canCloseContents="false"
      factoryClass="org.jetbrains.bazel.ui.widgets.tool.window.all.targets.BazelAllTargetsWidgetFactory"
      icon="org.jetbrains.bazel.assets.BazelPluginIcons.bazelToolWindow"
      id="Bazel"
    />

    <toolWindowAllowlist id="Bazel Query" />
    <toolWindowExtractor
      implementation="org.jetbrains.bazel.ui.widgets.queryTab.BazelQueryToolWindowViewModelExtractor"
    />

    <consoleFilterProvider
      implementation="org.jetbrains.bazel.ui.console.filter.AbsoluteAndRelativePathsConsoleFilterProvider"
    />

    <notificationGroup
      displayType="BALLOON"
      id="BazelPlugin"
      key="notificationGroup.BazelPlugin.title"
    />
    <editorNotificationProvider
      implementation="org.jetbrains.bazel.ui.notifications.BuildAndResyncOnUnresolvedImportNotificationsProvider"
    />

    <statistics.projectUsagesCollector implementation="org.jetbrains.bazel.fus.BazelProjectStatisticsCollector" />

    <disableCompilationDependenciesResolutionTask
      implementation="org.jetbrains.bazel.jpsCompilation.utils.DisableCompilationDependenciesResolutionImpl"
    />
    <projectService
      serviceImplementation="org.jetbrains.bazel.server.connection.BazelServerServiceImpl"
      serviceInterface="org.jetbrains.bazel.server.connection.BazelServerService"
    />
    <projectService
      serviceImplementation="org.jetbrains.bazel.languages.projectview.ProjectViewWorkspaceContextProvider"
      serviceInterface="org.jetbrains.bazel.workspacecontext.provider.WorkspaceContextProvider"
    />

    <consoleFilterProvider implementation="org.jetbrains.bazel.ui.console.BazelBuildTargetConsoleFilterProvider" />

    <attachSourcesProvider implementation="org.jetbrains.bazel.ui.notifications.BazelAttachSourcesProvider" />
    <projectOpenProcessor implementation="org.jetbrains.bazel.flow.open.BazelProjectOpenProcessor" />
    <projectPreInit implementation="org.jetbrains.bazel.flow.open.OpenBazelProjectAndSyncStartupActivity"/>
    <notificationGroup
      displayType="BALLOON"
      id="BazelSlowPlugins"
      key="notificationGroup.BazelSlowPlugins.title"
    />

    <externalSystemUnlinkedProjectAware
      id="Bazel"
      implementation="org.jetbrains.bazel.flow.open.BazelUnlinkedProjectAware"
    />

    <projectStorePathCustomizer implementation="org.jetbrains.bazel.flow.open.BazelProjectStorePathCustomizer"/>

    <directoryProjectConfigurator implementation="org.jetbrains.bazel.flow.open.exclude.BazelSymlinkExcludeDirectoryProjectConfigurator"/>
    <externalIconProvider
      implementationClass="org.jetbrains.bazel.flow.open.BazelExternalSystemIconProvider"
      key="bazel"
    />
    <projectModelModifier implementation="org.jetbrains.bazel.flow.modify.BazelProjectModelModifier" />

    <fileType
      extensions="bzl;bazel;bzlmod;star"
      fieldName="INSTANCE"
      fileNames="BUILD;WORKSPACE"
      implementationClass="org.jetbrains.bazel.languages.starlark.StarlarkFileType"
      language="Starlark"
      name="Starlark"
      patterns="*.bzl.template"
    />
    <lang.fileViewProviderFactory
      implementationClass="org.jetbrains.bazel.languages.starlark.psi.StarlarkViewProviderFactory"
      language="Starlark"
    />
    <enterBetweenBracesDelegate
      implementationClass="org.jetbrains.bazel.languages.starlark.indentation.StarlarkEnterBetweenBracesHandler"
      language="Starlark"
    />
    <lang.parserDefinition
      implementationClass="org.jetbrains.bazel.languages.starlark.parser.StarlarkParserDefinition"
      language="Starlark"
    />
    <lang.syntaxHighlighterFactory
      implementationClass="org.jetbrains.bazel.languages.starlark.highlighting.StarlarkSyntaxHighlighterFactory"
      language="Starlark"
    />
    <lang.commenter
      implementationClass="org.jetbrains.bazel.languages.starlark.commenter.StarlarkCommenter"
      language="Starlark"
    />
    <lang.braceMatcher
      implementationClass="org.jetbrains.bazel.languages.starlark.matching.StarlarkBraceMatcher"
      language="Starlark"
    />
    <lang.quoteHandler
      implementationClass="org.jetbrains.bazel.languages.starlark.matching.StarlarkQuoteHandler"
      language="Starlark"
    />
    <lang.findUsagesProvider
      implementationClass="org.jetbrains.bazel.languages.starlark.findusages.StarlarkFindUsagesProvider"
      language="Starlark"
    />
    <lang.elementManipulator
      forClass="org.jetbrains.bazel.languages.starlark.psi.expressions.StarlarkStringLiteralExpression"
      implementationClass="org.jetbrains.bazel.languages.starlark.rename.StarlarkStringLiteralManipulator"
    />
    <lang.foldingBuilder
      implementationClass="org.jetbrains.bazel.languages.starlark.folding.StarlarkFoldingBuilder"
      language="Starlark"
    />
    <lineIndentProvider
      implementation="org.jetbrains.bazel.languages.starlark.indentation.StarlarkLineIndentProvider"
    />
    <colorSettingsPage implementation="org.jetbrains.bazel.languages.starlark.highlighting.StarlarkColorSettingsPage" />
    <additionalTextAttributes
      file="colorSchemes/StarlarkDefault.xml"
      scheme="Default"
    />
    <additionalTextAttributes
      file="colorSchemes/StarlarkDarcula.xml"
      scheme="Darcula"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.starlark.annotation.StarlarkDeclarationAnnotator"
      language="Starlark"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.starlark.annotation.StarlarkFunctionAnnotator"
      language="Starlark"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.starlark.annotation.StarlarkStringAnnotator"
      language="Starlark"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.starlark.annotation.StarlarkLoadAnnotator"
      language="Starlark"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.starlark.annotation.StarlarkGlobAnnotator"
      language="Starlark"
    />
    <completion.confidence
      implementationClass="org.jetbrains.bazel.languages.starlark.completion.StarlarkCompletionConfidence"
      language="Starlark"
    />
    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.starlark.completion.BazelGlobalFunctionCompletionContributor"
      language="Starlark"
    />
    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.starlark.completion.StarlarkParamsCompletionContributor"
      language="Starlark"
    />
    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.starlark.completion.StarlarkArgumentCompletionContributor"
      language="Starlark"
    />
    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.starlark.completion.StarlarkClassnameCompletionContributor"
      language="Starlark"
    />
    <editorTabTitleProvider
      implementation="org.jetbrains.bazel.ui.tabs.BazelEditorTabTitleProvider"/>
    <extendWordSelectionHandler
      implementation="org.jetbrains.bazel.languages.starlark.actions.StarlarkStringLiteralSelectioner"
    />
    <fileType
      extensions="bazelproject"
      fieldName="INSTANCE"
      implementationClass="org.jetbrains.bazel.languages.projectview.base.ProjectViewFileType"
      language="ProjectView"
      name="ProjectView"
    />
    <lang.syntaxHighlighterFactory
      implementationClass="org.jetbrains.bazel.languages.projectview.highlighting.ProjectViewSyntaxHighlighterFactory"
      language="ProjectView"
    />
    <lang.commenter
      implementationClass="org.jetbrains.bazel.languages.projectview.commenter.ProjectViewCommenter"
      language="ProjectView"
    />
    <langCodeStyleSettingsProvider
      implementation="org.jetbrains.bazel.languages.projectview.formatting.ProjectViewLanguageCodeStyleSettingsProvider"
    />
    <enterHandlerDelegate
      implementation="org.jetbrains.bazel.languages.projectview.formatting.ProjectViewEnterHandler"
    />
    <lang.parserDefinition
      implementationClass="org.jetbrains.bazel.languages.projectview.parser.ProjectViewParserDefinition"
      language="ProjectView"
    />
    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.projectview.completion.ProjectViewSectionCompletionContributor"
      language="ProjectView"
    />
    <annotator
      implementationClass="org.jetbrains.bazel.languages.projectview.annotation.ProjectViewAnnotator"
      language="ProjectView"
    />
    <formattingService implementation="org.jetbrains.bazel.languages.starlark.formatting.StarlarkFormattingService" />
    <actionOnSave
      id="StarlarkFormattingActionOnSave"
      implementation="org.jetbrains.bazel.languages.starlark.formatting.StarlarkFormattingActionOnSave"
    />

    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.projectview.completion.ProjectViewSectionItemCompletionContributor"
      language="ProjectView"
    />
    <typedHandler
      implementation="org.jetbrains.bazel.languages.projectview.completion.ProjectViewSectionItemCompletionContributor$AutoPopup"
    />

    <platform.backend.documentation.targetProvider
      id="ProjectViewFlagDocumentationTargetProvider"
      implementation="org.jetbrains.bazel.languages.projectview.documentation.ProjectViewFlagDocumentationTargetProvider"
    />

    <platform.backend.documentation.targetProvider
      id="ProjectViewSectionDocumentationTargetProvider"
      implementation="org.jetbrains.bazel.languages.projectview.documentation.ProjectViewSectionDocumentationTargetProvider"
    />

    <runLineMarkerContributor
      implementationClass="org.jetbrains.bazel.ui.gutters.StarlarkRunLineMarkerContributor"
      language="Starlark"
    />

    <fileType
      extensions="bazelquery"
      fieldName="INSTANCE"
      implementationClass="org.jetbrains.bazel.languages.bazelquery.BazelQueryFileType"
      language="BazelQuery"
      name="BazelQuery"
    />

    <lang.parserDefinition
      implementationClass="org.jetbrains.bazel.languages.bazelquery.parser.BazelQueryParserDefinition"
      language="BazelQuery"
    />

    <lang.syntaxHighlighterFactory
      implementationClass="org.jetbrains.bazel.languages.bazelquery.highlighting.BazelQuerySyntaxHighlighterFactory"
      language="BazelQuery"
    />

    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.bazelquery.completion.BazelQueryCompletionContributor"
      language="BazelQuery"
    />

    <lookup.charFilter implementation="org.jetbrains.bazel.languages.bazelquery.completion.BazelQueryCharFilter"/>


    <fileType
      extensions="bazelqueryflags"
      fieldName="INSTANCE"
      implementationClass="org.jetbrains.bazel.languages.bazelquery.BazelQueryFlagsFileType"
      language="BazelQueryFlags"
      name="BazelQueryFlags"
    />

    <lang.parserDefinition
      implementationClass="org.jetbrains.bazel.languages.bazelquery.parser.BazelQueryFlagsParserDefinition"
      language="BazelQueryFlags"
    />

    <lang.syntaxHighlighterFactory
      implementationClass="org.jetbrains.bazel.languages.bazelquery.highlighting.BazelQuerySyntaxHighlighterFactory"
      language="BazelQueryFlags"
    />

    <fileType name="BazelVersion"
              implementationClass="org.jetbrains.bazel.languages.bazelversion.BazelVersionFileType"
              fieldName="INSTANCE"
              language="BazelVersion"
              fileNames=".bazelversion"
              extensions="bazelversion"/>

    <lang.parserDefinition language="BazelVersion"
                           implementationClass="org.jetbrains.bazel.languages.bazelversion.parser.BazelVersionParserDefinition"/>

    <localInspection language="BazelVersion"
                     key="inspection.display.name.bazel.version.check"
                     groupName="Bazel"
                     enabledByDefault="true"
                     level="WARNING"
                     implementationClass="org.jetbrains.bazel.languages.bazelversion.inspection.BazelVersionInspection"/>

    <fileType
      extensions="bazelrc"
      fieldName="INSTANCE"
      fileNames=".bazelrc"
      implementationClass="org.jetbrains.bazel.languages.bazelrc.BazelrcFileType"
      language="Bazelrc"
      name="Bazelrc"
    />

    <lang.syntaxHighlighterFactory
      implementationClass="org.jetbrains.bazel.languages.bazelrc.highlighting.BazelrcSyntaxHighlighterFactory"
      language="Bazelrc"
    />

    <lang.parserDefinition
      implementationClass="org.jetbrains.bazel.languages.bazelrc.parser.BazelrcParserDefinition"
      language="Bazelrc"
    />

    <lang.commenter
      implementationClass="org.jetbrains.bazel.languages.bazelrc.commenter.BazelrcCommenter"
      language="Bazelrc"
    />

    <lang.quoteHandler
      implementationClass="org.jetbrains.bazel.languages.bazelrc.matching.BazelrcQuoteHandler"
      language="Bazelrc"
    />

    <annotator
      implementationClass="org.jetbrains.bazel.languages.bazelrc.annotation.BazelrcFlagAnnotator"
      language="Bazelrc"
    />

    <completion.contributor
      implementationClass="org.jetbrains.bazel.languages.bazelrc.completion.BazelrcCompletionContributor"
      language="Bazelrc"
    />

    <projectConfigurable
      key="project.configurable.display.name.bazel"
      id="bazel.project.settings"
      instance="org.jetbrains.bazel.ui.settings.BazelProjectSettingsConfigurable"
      parentId="build.tools"
      provider="org.jetbrains.bazel.ui.settings.BazelProjectSettingsConfigurableProvider"
    >
      <configurable
        key="configurable.display.name.bazel.experimental.project.settings"
        id="bazel.experimental.project.settings"
        instance="org.jetbrains.bazel.ui.settings.BazelExperimentalProjectSettingsConfigurable"
        provider="org.jetbrains.bazel.ui.settings.BazelExperimentalProjectSettingsConfigurableProvider"
      />
    </projectConfigurable>

    <applicationConfigurable
      key="advanced.settings.display.name"
      id="bazel.application.settings"
      instance="org.jetbrains.bazel.ui.settings.BazelApplicationSettingsConfigurable"
      parentId="bazel.project.settings"
      provider="org.jetbrains.bazel.ui.settings.BazelApplicationSettingsConfigurableProvider"
    />

    <obsoleteStorage
      file="$WORKSPACE_FILE$"
      isProjectLevel="true"
    >
      <components>
        <component>TargetUtils</component>
      </components>
    </obsoleteStorage>
    <projectViewNodeDecorator implementation="org.jetbrains.bazel.settings.ProjectViewFileNodeDecorator" />
    <projectViewNodeDecorator implementation="org.jetbrains.bazel.sync.status.unsynced.UnsyncedSourceFileNodeDecorator" />
    <editorTabColorProvider implementation="org.jetbrains.bazel.sync.status.unsynced.UnsyncedSourceFileEditorTabColorProvider"/>
    <editorTabTitleProvider implementation="org.jetbrains.bazel.sync.status.unsynced.UnsyncedSourceFileEditorTabTitleProvider"/>
    <editorNotificationProvider implementation="org.jetbrains.bazel.sync.status.unsynced.UnsyncedSourceFileNotificationProvider"/>
    <referencesSearch implementation="org.jetbrains.bazel.languages.starlark.findusages.StarlarkStringUsageSearcher" />
    <referencesSearch implementation="org.jetbrains.bazel.languages.starlark.findusages.StarlarkFileUsageSearcher"/>
    <usageTypeProvider implementation="org.jetbrains.bazel.languages.starlark.findusages.StarlarkUsageTypeProvider" />
    <xdebugger.breakpointType implementation="org.jetbrains.bazel.debug.platform.StarlarkBreakpointType" />
    <programRunner implementation="org.jetbrains.bazel.debug.configuration.StarlarkDebugRunner" />
    <search.optionContributor implementation="org.jetbrains.bazel.ui.settings.BazelSearchOptionsContributor" />
    <searchEverywhereContributor
      implementation="org.jetbrains.bazel.ui.widgets.LabelSearchEverywhereContributor$Factory"
    />
    <searchEverywhere.itemsProviderFactory
      implementation="org.jetbrains.bazel.searchEverywhere.SeLabelProviderFactory"
    />

    <execution.processHandlerPidProvider implementation="org.jetbrains.bazel.run.BazelProcessHandlerPidProvider"/>
  </extensions>

  <actions>
    <action
      class="org.jetbrains.bazel.ui.projectTree.action.RunAllTestsAction"
      id="BazelRunAllTestsAction"
    >
      <add-to-group
        anchor="last"
        group-id="EditorPopupMenu"
      />
      <add-to-group
        anchor="last"
        group-id="ProjectViewPopupMenu"
      />
    </action>
    <action
      class="org.jetbrains.bazel.action.registered.ResyncAction"
      icon="/icons/resync.svg"
      id="Bazel.ResyncAction"
    />
    <action
      class="org.jetbrains.bazel.action.registered.BuildAndResyncAction"
      icon="/icons/buildAndResync.svg"
      id="Bazel.BuildAndResyncAction"
    />
    <action
      class="org.jetbrains.bazel.action.registered.NewBazelPackageAction"
      id="Bazel.NewBazelPackageAction"
    >
      <add-to-group
        anchor="after"
        group-id="NewGroup"
        relative-to-action="NewDir"
      />
    </action>

    <group id="Bazel.ActionsToolbar">
      <reference id="Bazel.ResyncAction" />
      <reference id="Bazel.BuildAndResyncAction" />
    </group>

    <action
      class="org.jetbrains.bazel.settings.LoadProjectViewFileAction"
      icon="/icons/bazel.svg"
    >
      <add-to-group
        anchor="last"
        group-id="EditorPopupMenu"
      />
      <add-to-group
        anchor="last"
        group-id="ProjectViewPopupMenu"
      />
    </action>
    <action
      class="org.jetbrains.bazel.ui.widgets.CopyTargetIdAction"
      icon="/icons/bazel.svg"
    >
      <add-to-group group-id="EditorPopupMenu" />
      <add-to-group group-id="EditorTabPopupMenu" />
      <!-- This shortcut doesn't mean anything, it's just not taken by anyone and is easy to type -->
      <keyboard-shortcut
        first-keystroke="control alt G"
        keymap="$default"
        second-keystroke="H"
      />
    </action>
    <action id="Bazel.JumpToBuildFile"
            class="org.jetbrains.bazel.ui.widgets.BazelJumpToBuildFileAction$XmlRegistered">
      <add-to-group group-id="EditorPopupMenu" />
      <add-to-group group-id="EditorTabPopupMenu" />
      <keyboard-shortcut
        first-keystroke="control alt G"
        keymap="$default"
        second-keystroke="J"
      />
    </action>
    <action
      class="org.jetbrains.bazel.flow.open.actions.LinkBazelProjectFromScriptAction"
      id="Bazel.ImportExternalProject"
    >
      <add-to-group
        anchor="last"
        group-id="ProjectViewPopupMenuSettingsGroup"
      />
      <add-to-group
        anchor="last"
        group-id="EditorPopupMenu"
      />
    </action>

    <action id="Bazel.AddToProjectViewDirectoriesAction"
            class="org.jetbrains.bazel.action.registered.projectViewDirectories.AddToProjectViewDirectoriesAction">
    </action>

    <action id="Bazel.ExcludeFromProjectViewDirectoriesAction"
            class="org.jetbrains.bazel.action.registered.projectViewDirectories.ExcludeFromProjectViewDirectoriesAction">
    </action>

    <action id="Bazel.OpenBazelQueryToolWindowAction"
            class="org.jetbrains.bazel.action.registered.OpenBazelQueryToolWindowAction">
    </action>

    <action id="Bazel.OpenProjectViewFile"
            class="org.jetbrains.bazel.action.registered.OpenProjectViewAction">
    </action>

    <group id="Bazel.ModifyProjectViewDirectories">
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
      <reference id="Bazel.AddToProjectViewDirectoriesAction"/>
      <reference id="Bazel.ExcludeFromProjectViewDirectoriesAction"/>
    </group>
  </actions>

  <applicationListeners>
    <listener
      class="org.jetbrains.bazel.workspace.AssignFileToModuleListener"
      topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"
    />
    <listener
      class="org.jetbrains.bazel.workspace.packageMarker.PackageMarkerEntityListener"
      topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"
    />
  </applicationListeners>
</idea-plugin>
